(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();const M="/CrappyEngineJS/vite.svg",A=600,S={x:0,y:-.5,z:-8},z=.002,p=.2,f=.1,d=20,l=["red","green","blue","yellow","purple","orange"],m=[{vertices:[0,1,2],color:l[0]},{vertices:[0,2,3],color:l[0]},{vertices:[4,5,6],color:l[1]},{vertices:[4,6,7],color:l[1]},{vertices:[0,1,5],color:l[2]},{vertices:[0,5,4],color:l[2]},{vertices:[2,3,7],color:l[3]},{vertices:[2,7,6],color:l[3]},{vertices:[1,2,6],color:l[4]},{vertices:[1,6,5],color:l[4]},{vertices:[0,3,7],color:l[5]},{vertices:[0,7,4],color:l[5]}],D=[{x:0,y:0,z:0},{x:1,y:0,z:0},{x:1,y:1,z:0},{x:0,y:1,z:0},{x:0,y:0,z:1},{x:1,y:0,z:1},{x:1,y:1,z:1},{x:0,y:1,z:1}],g=(t,o=1)=>({type:"cube",position:t,vertices:D.map(n=>({x:n.x*o,y:n.y*o,z:n.z*o})),faces:m}),L=(t,o=1)=>{const n=[],i=[];for(let s=0;s<=d;s++){const c=s*Math.PI/d,a=Math.sin(c),h=Math.cos(c);for(let r=0;r<=d;r++){const y=r*2*Math.PI/d,w=Math.sin(y),E=Math.cos(y);n.push({x:o*a*E,y:o*h,z:o*a*w})}}const e=d+1;for(let s=0;s<d;s++)for(let c=0;c<d;c++){const a=s*e+c,h=a+e;i.push({vertices:[a,h,a+1],color:"#ccc"}),i.push({vertices:[h,h+1,a+1],color:"#aaa"})}return{position:t,type:"sphere",vertices:n,faces:i}},C=g({x:0,y:0,z:0}),P=g({x:3,y:1,z:4},2),b=g({x:-4,y:-2,z:-1},3),T=L({x:0,y:-5,z:0},1.5),_=[C,P,b,T],I=(t,o)=>{const n=Math.cos(o),i=Math.sin(o);return{x:t.x*n-t.z*i,y:t.y,z:t.x*i+t.z*n}},R=(t,o)=>{const n=Math.cos(o),i=Math.sin(o);return{x:t.x,y:t.y*n-t.z*i,z:t.y*i+t.z*n}},F=(t,o)=>{const n={x:-Math.sin(o.yaw)*Math.cos(o.pitch),y:-Math.sin(o.pitch),z:Math.cos(o.yaw)*Math.cos(o.pitch)},i={x:Math.cos(o.yaw),z:Math.sin(o.yaw)};["z","ArrowUp"].includes(t.key)&&(o.position.x+=n.x*p,o.position.y+=n.y*p,o.position.z+=n.z*p),["s","ArrowDown"].includes(t.key)&&(o.position.x-=n.x*p,o.position.y-=n.y*p,o.position.z-=n.z*p),["q","ArrowLeft"].includes(t.key)&&(o.position.x-=i.x*f,o.position.z-=i.z*f),["d","ArrowRight"].includes(t.key)&&(o.position.x+=i.x*f,o.position.z+=i.z*f)},O=(t,o)=>{t.deltaY>0&&(o.position.y+=p),t.deltaY<0&&(o.position.y-=p)},k=(t,o,n)=>{if(document.pointerLockElement!==n)return;o.yaw-=t.movementX*z,o.pitch-=t.movementY*z;const i=Math.PI/2-.01;o.pitch=Math.max(-i,Math.min(i,o.pitch))},q=(t,o,n)=>{const i=[];for(const e of t.vertices){const s=o[e],c=s.x-n.position.x,a=s.y-n.position.y,h=s.z-n.position.z,r=Math.sqrt(c*c+a*a+h*h);i.push(r)}return i.length?i.reduce((e,s)=>e+s,0)/i.length:0},U=(t,o,n,i)=>{let e={x:t.x-o.position.x,y:t.y-o.position.y,z:t.z-o.position.z};return e=I(e,-o.yaw),e=R(e,-o.pitch),e.z<=0?null:{x:e.x/e.z*o.fov+n/2,y:e.y/e.z*o.fov+i/2}},Y=(t,o,n)=>{const i=[];for(const e of o){const s=e.vertices.map(r=>({x:r.x+e.position.x,y:r.y+e.position.y,z:r.z+e.position.z})),c=s.map(r=>U(r,n,t.canvas.width,t.canvas.height)).filter(r=>r!==null),a=e.faces.map(r=>({...r,distance:q(r,s,n)})),h=a.toSorted((r,y)=>y.distance-r.distance);i.push({type:e.type,projected:c,sortedFaces:h,avgDistance:a.reduce((r,y)=>r+y.distance,0)/a.length})}return i},N=(t,o,n)=>{for(const i of n){t.beginPath(),t.fillStyle=i.color,t.strokeStyle=i.color;const e=o[i.vertices[0]];if(e){t.moveTo(e.x,e.y);for(let s=1;s<3;s++){const c=o[i.vertices[s]];if(!c)break;t.lineTo(c.x,c.y)}t.closePath(),t.fill(),t.stroke()}}},J=(t,o,n)=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="white",t.fillRect(0,0,t.canvas.width,t.canvas.height);const e=Y(t,o,n).toSorted((s,c)=>c.avgDistance-s.avgDistance);for(const s of e)N(t,s.projected,s.sortedFaces)};document.querySelector("#app").innerHTML=`
    <h1><img src="${M}" class="logo" alt="Logo de CrappyEngineJs" />CrappyEngineJs</h1>
    <p class="subtitle">
      Crappy engine is a 3D engine built with vanilla JavaScript. It is an experiment with no purpose and no future.<br/>
      Use the <strong>arrow keys</strong> or <strong>ZQSD</strong> to move the camera, the <strong>mouse</strong> to look around and the <strong>wheel</strong> to move up and down.
    </p>
    <div class="canvas-container">
      <canvas class="canvas" width="1280" height="720"></canvas>
    </div>
`;const u=document.querySelector(".canvas"),X={ctx:u.getContext("2d"),width:u.width,height:u.height},v={position:S,fov:A,yaw:0,pitch:0};document.addEventListener("keydown",t=>F(t,v));document.addEventListener("wheel",t=>O(t,v));document.addEventListener("mousemove",t=>k(t,v,u));u.addEventListener("click",()=>u.requestPointerLock());const x=()=>{J(X.ctx,_,v),requestAnimationFrame(x)};window.addEventListener("load",()=>{x()});
