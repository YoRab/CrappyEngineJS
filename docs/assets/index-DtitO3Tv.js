(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();const A="/CrappyEngineJS/vite.svg",S=600,D={x:0,y:-.5,z:-8},g=.002,p=.2,z=.1,d=20,y=["red","green","blue","yellow","purple","orange"],m=[{vertices:[0,2,1],color:y[0]},{vertices:[0,3,2],color:y[0]},{vertices:[4,5,6],color:y[1]},{vertices:[4,6,7],color:y[1]},{vertices:[0,1,5],color:y[2]},{vertices:[0,5,4],color:y[2]},{vertices:[2,3,7],color:y[3]},{vertices:[2,7,6],color:y[3]},{vertices:[1,2,6],color:y[4]},{vertices:[1,6,5],color:y[4]},{vertices:[0,7,3],color:y[5]},{vertices:[0,4,7],color:y[5]}],L=[{x:0,y:0,z:0},{x:1,y:0,z:0},{x:1,y:1,z:0},{x:0,y:1,z:0},{x:0,y:0,z:1},{x:1,y:0,z:1},{x:1,y:1,z:1},{x:0,y:1,z:1}],v=(t,o=1)=>({type:"cube",position:t,vertices:L.map(i=>({x:i.x*o,y:i.y*o,z:i.z*o})),faces:m}),C=(t,o=1)=>{const i=[],s=[];for(let n=0;n<=d;n++){const r=n*Math.PI/d,l=Math.sin(r),a=Math.cos(r);for(let c=0;c<=d;c++){const h=c*2*Math.PI/d,x=Math.sin(h),E=Math.cos(h);i.push({x:o*l*E,y:o*a,z:o*l*x})}}const e=d+1;for(let n=0;n<d;n++)for(let r=0;r<d;r++){const l=n*e+r,a=l+e;s.push({vertices:[l,l+1,a],color:"#ccc"}),s.push({vertices:[a,l+1,a+1],color:"#aaa"})}return{position:t,type:"sphere",vertices:i,faces:s}},P=v({x:0,y:0,z:0}),F=v({x:3,y:1,z:4},2),T=v({x:-4,y:-2,z:-1},3),_=C({x:0,y:-5,z:0},1.5),I=[P,F,T,_],R=(t,o)=>{const i=Math.cos(o),s=Math.sin(o);return{x:t.x*i-t.z*s,y:t.y,z:t.x*s+t.z*i}},O=(t,o)=>{const i=Math.cos(o),s=Math.sin(o);return{x:t.x,y:t.y*i-t.z*s,z:t.y*s+t.z*i}},b=(t,o)=>{const i={x:-Math.sin(o.yaw)*Math.cos(o.pitch),y:-Math.sin(o.pitch),z:Math.cos(o.yaw)*Math.cos(o.pitch)},s={x:Math.cos(o.yaw),z:Math.sin(o.yaw)};["z","ArrowUp"].includes(t.key)&&(o.position.x+=i.x*p,o.position.y+=i.y*p,o.position.z+=i.z*p),["s","ArrowDown"].includes(t.key)&&(o.position.x-=i.x*p,o.position.y-=i.y*p,o.position.z-=i.z*p),["q","ArrowLeft"].includes(t.key)&&(o.position.x-=s.x*z,o.position.z-=s.z*z),["d","ArrowRight"].includes(t.key)&&(o.position.x+=s.x*z,o.position.z+=s.z*z)},k=(t,o)=>{t.deltaY>0&&(o.position.y+=p),t.deltaY<0&&(o.position.y-=p)},q=(t,o,i)=>{if(document.pointerLockElement!==i)return;o.yaw-=t.movementX*g,o.pitch-=t.movementY*g;const s=Math.PI/2-.01;o.pitch=Math.max(-s,Math.min(s,o.pitch))},U=(t,o,i)=>{const s=[];for(const e of t.vertices){const n=o[e],r=n.x-i.position.x,l=n.y-i.position.y,a=n.z-i.position.z,c=Math.sqrt(r*r+l*l+a*a);s.push(c)}return s.length?s.reduce((e,n)=>e+n,0)/s.length:0},Y=(t,o,i,s)=>{let e={x:t.x-o.position.x,y:t.y-o.position.y,z:t.z-o.position.z};return e=R(e,-o.yaw),e=O(e,-o.pitch),e.z<=0?null:{x:e.x/e.z*o.fov+i/2,y:e.y/e.z*o.fov+s/2}},N=(t,o)=>({x:t.y*o.z-t.z*o.y,y:t.z*o.x-t.x*o.z,z:t.x*o.y-t.y*o.x}),V=(t,o)=>t.x*o.x+t.y*o.y+t.z*o.z,w=t=>{const o=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return o===0?{x:0,y:0,z:0}:{x:t.x/o,y:t.y/o,z:t.z/o}},J=(t,o,i)=>{const s=o[t.vertices[0]],e=o[t.vertices[1]],n=o[t.vertices[2]],r={x:e.x-s.x,y:e.y-s.y,z:e.z-s.z},l={x:n.x-s.x,y:n.y-s.y,z:n.z-s.z},a=w(N(r,l)),c={x:(s.x+e.x+n.x)/3,y:(s.y+e.y+n.y)/3,z:(s.z+e.z+n.z)/3},h={x:i.position.x-c.x,y:i.position.y-c.y,z:i.position.z-c.z},x=w(h);return V(a,x)>0},X=(t,o,i)=>{const s=[];for(const e of o){const n=e.vertices.map(c=>({x:c.x+e.position.x,y:c.y+e.position.y,z:c.z+e.position.z})),r=n.map(c=>Y(c,i,t.canvas.width,t.canvas.height)).filter(c=>c!==null),a=e.faces.filter(c=>J(c,n,i)).map(c=>({...c,distance:U(c,n,i)})).toSorted((c,h)=>h.distance-c.distance);s.push({type:e.type,projected:r,sortedFaces:a,avgDistance:a.length>0?a.reduce((c,h)=>c+h.distance,0)/a.length:0})}return s},j=(t,o,i)=>{for(const s of i){t.beginPath(),t.fillStyle=s.color,t.strokeStyle=s.color;const e=o[s.vertices[0]];if(e){t.moveTo(e.x,e.y);for(let n=1;n<3;n++){const r=o[s.vertices[n]];if(!r)break;t.lineTo(r.x,r.y)}t.closePath(),t.fill(),t.stroke()}}},H=(t,o,i)=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="white",t.fillRect(0,0,t.canvas.width,t.canvas.height);const e=X(t,o,i).toSorted((n,r)=>r.avgDistance-n.avgDistance);for(const n of e)j(t,n.projected,n.sortedFaces)};document.querySelector("#app").innerHTML=`
    <h1><img src="${A}" class="logo" alt="Logo de CrappyEngineJs" />CrappyEngineJs</h1>
    <p class="subtitle">
      Crappy engine is a 3D engine built with vanilla JavaScript. It is an experiment with no purpose and no future.<br/>
      Use the <strong>arrow keys</strong> or <strong>ZQSD</strong> to move the camera, the <strong>mouse</strong> to look around and the <strong>wheel</strong> to move up and down.
    </p>
    <div class="canvas-container">
      <canvas class="canvas" width="1280" height="720"></canvas>
    </div>
`;const u=document.querySelector(".canvas"),Z={ctx:u.getContext("2d"),width:u.width,height:u.height},f={position:D,fov:S,yaw:0,pitch:0};document.addEventListener("keydown",t=>b(t,f));document.addEventListener("wheel",t=>k(t,f));document.addEventListener("mousemove",t=>q(t,f,u));u.addEventListener("click",()=>u.requestPointerLock());const M=()=>{H(Z.ctx,I,f),requestAnimationFrame(M)};window.addEventListener("load",()=>{M()});
